{"version":3,"sources":["../../../../lib/transactions/service.ts","../../../../components/transactions/client.tsx/__nextjs-internal-proxy.mjs","../../../../app/%28with-auth%29/transactions/page.tsx"],"sourcesContent":["import { createClient } from '@/lib/supabase/server'\nimport { getUserAccounts, getUserDefaultAccount } from \"@/lib/accounts/service\"\n\nexport async function getAccountTransactions(accountId: string) {\n  const supabase = await createClient()\n  \n  const { data, error } = await supabase\n    .from('transactions')\n    .select('*')\n    .eq('account_id', accountId)\n    .order('date', { ascending: false })\n  \n  if (error) {\n    throw new Error(error.message)\n  }\n  \n  return data\n}\n\nexport async function getAccountTransactionsByDateRange(accountId: string, startDate: string, endDate: string) {\n  const supabase = await createClient()\n  \n  const { data, error } = await supabase\n    .from('transactions')\n    .select('*')\n    .eq('account_id', accountId)\n    .gte('date', startDate)\n    .lte('date', endDate)\n    .order('date', { ascending: false })\n  \n  if (error) {\n    throw new Error(error.message)\n  }\n  \n  return data\n}\n\nexport async function getTransactionById(transactionId: string) {\n  const supabase = await createClient()\n  \n  const { data, error } = await supabase\n    .from('transactions')\n    .select('*')\n    .eq('id', transactionId)\n    .single()\n  \n  if (error) {\n    throw new Error(error.message)\n  }\n  \n  return data\n}\n\nexport async function createTransaction(transactionData: any) {\n  const supabase = await createClient()\n  \n  const { data, error } = await supabase\n    .from('transactions')\n    .insert(transactionData)\n    .select()\n    .single()\n  \n  if (error) {\n    throw new Error(error.message)\n  }\n  \n  return data\n}\n\nexport async function updateTransaction(transactionId: string, transactionData: any) {\n  const supabase = await createClient()\n  \n  const { data, error } = await supabase\n    .from('transactions')\n    .update(transactionData)\n    .eq('id', transactionId)\n    .select()\n    .single()\n  \n  if (error) {\n    throw new Error(error.message)\n  }\n  \n  return data\n}\n\nexport async function deleteTransaction(transactionId: string) {\n  const supabase = await createClient()\n  \n  const { data, error } = await supabase\n    .from('transactions')\n    .delete()\n    .eq('id', transactionId)\n    .select()\n    .single()\n  \n  if (error) {\n    throw new Error(error.message)\n  }\n  \n  return data\n}\n\nexport async function doesTransactionBelongToUserAccounts(transactionId: string, accountIds: string[]) {\n  const supabase = await createClient()\n  \n  const { data, error } = await supabase\n    .from('transactions')\n    .select('id')\n    .eq('id', transactionId)\n    .in('account_id', accountIds)\n    .single()\n  \n  if (error) {\n    return false\n  }\n  \n  return !!data\n}\n\nexport async function updateTransactionForUser(transactionId: string, updateData: any, userAccountIds: string[]) {\n  const supabase = await createClient()\n  \n  const { data, error } = await supabase\n    .from('transactions')\n    .update(updateData)\n    .eq('id', transactionId)\n    .in('account_id', userAccountIds)\n    .select()\n    .single()\n  \n  if (error) {\n    throw new Error(error.message)\n  }\n  \n  if (!data) {\n    throw new Error('Transaction not found or unauthorized')\n  }\n  \n  return data\n}\n\nexport async function listTransactionsForUser(\n  userAccountIds: string[], \n  filters?: {\n    search?: string,\n    category?: string,\n    startDate?: string,\n    endDate?: string,\n    filter?: 'daily' | 'weekly' | 'monthly' | 'yearly'\n  }\n) {\n  const supabase = await createClient()\n  \n  // Build the query\n  let query = supabase\n    .from('transactions')\n    .select('*')\n    .in('account_id', userAccountIds)\n  \n  // Apply search filter\n  if (filters?.search) {\n    query = query.ilike('reason', `%${filters.search}%`)\n  }\n  \n  // Apply category filter\n  if (filters?.category) {\n    query = query.eq('category', filters.category)\n  }\n  \n  // Apply date range filter\n  if (filters?.startDate) {\n    query = query.gte('date', new Date(filters.startDate).toISOString())\n  }\n  \n  if (filters?.endDate) {\n    query = query.lte('date', new Date(filters.endDate).toISOString())\n  }\n  \n  // Apply period filter\n  const now = new Date()\n  if (filters?.filter) {\n    let startOfDay, endOfDay\n    \n    switch (filters.filter) {\n      case 'daily':\n        startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate())\n        endOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59, 999)\n        break\n      case 'weekly':\n        const firstDayOfWeek = new Date(now)\n        firstDayOfWeek.setDate(now.getDate() - now.getDay())\n        startOfDay = new Date(firstDayOfWeek.getFullYear(), firstDayOfWeek.getMonth(), firstDayOfWeek.getDate())\n        endOfDay = new Date(firstDayOfWeek.getFullYear(), firstDayOfWeek.getMonth(), firstDayOfWeek.getDate() + 6, 23, 59, 59, 999)\n        break\n      case 'monthly':\n        startOfDay = new Date(now.getFullYear(), now.getMonth(), 1)\n        endOfDay = new Date(now.getFullYear(), now.getMonth() + 1, 0, 23, 59, 59, 999)\n        break\n      case 'yearly':\n        startOfDay = new Date(now.getFullYear(), 0, 1)\n        endOfDay = new Date(now.getFullYear(), 11, 31, 23, 59, 59, 999)\n        break\n    }\n    \n    if (startOfDay && endOfDay) {\n      query = query.gte('date', startOfDay.toISOString())\n      query = query.lte('date', endOfDay.toISOString())\n    }\n  }\n  \n  // Order by date descending\n  const { data, error } = await query\n    .order('date', { ascending: false })\n  \n  if (error) {\n    throw new Error(error.message)\n  }\n  \n  return data\n}\n\nexport async function getTransactionsPageData(userId: string, accountId?: string) {\n  // Get user's accounts\n  const accounts = await getUserAccounts(userId)\n  \n  // Determine which account to show\n  let selectedAccountId = accountId\n  \n  // If no account specified, use user's default account or first account\n  if (!selectedAccountId && accounts && accounts.length > 0) {\n    // Get user's default account\n    const userData = await getUserDefaultAccount(userId)\n    \n    if (userData?.default_account_id) {\n      selectedAccountId = userData.default_account_id\n    } else {\n      selectedAccountId = accounts[0].id\n    }\n  }\n  \n  // Get transactions for the selected account\n  const transactions = selectedAccountId \n    ? await getAccountTransactions(selectedAccountId) \n    : []\n  \n  return {\n    accounts,\n    selectedAccountId,\n    transactions\n  }\n}","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const TransactionsClient = registerClientReference(\n    function() { throw new Error(\"Attempted to call TransactionsClient() from the server but TransactionsClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/components/transactions/client.tsx\",\n    \"TransactionsClient\",\n);\n","import { ThemeToggle } from '@/components/layout/theme-toggle'\nimport { createClient } from '@/lib/supabase/server'\nimport { redirect } from 'next/navigation'\nimport { TransactionsClient } from \"@/components/transactions/client\"\nimport { getTransactionsPageData } from \"@/lib/transactions/service\"\nimport Link from \"next/link\"\nimport { Button } from \"@/components/ui/button\"\nimport { PlusIcon } from 'lucide-react'\nimport { getCachedUser } from \"@/lib/auth/service\"\nimport { Suspense } from 'react'\n\nasync function TransactionsContent(props: { searchParams: Promise<{ account?: string }> }) {\n  const searchParams = await props.searchParams\n  // Use cached user instead of calling getUser directly\n  const user = await getCachedUser()\n  \n  if (!user) {\n    redirect('/login')\n  }\n  \n  // Get transactions page data using the service function\n  const {\n    accounts,\n    selectedAccountId,\n    transactions\n  } = await getTransactionsPageData(user.id, searchParams.account)\n  \n  return (\n    <main className=\"flex-1 p-4 pb-20 md:p-8 md:pb-8\">\n      <div className=\"mx-auto max-w-4xl space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <h1 className=\"text-3xl font-bold\">Transactions</h1>\n          <div className=\"flex items-center gap-2\">\n            <ThemeToggle />\n            <Link href=\"/add\">\n              <Button className=\"bg-indigo-600 hover:bg-indigo-700\">\n                <PlusIcon className=\"mr-2 h-4 w-4\" />\n                <span className=\"hidden sm:inline\">Add Transaction</span>\n              </Button>\n            </Link>\n          </div>\n        </div>\n        \n        <TransactionsClient \n          initialTransactions={transactions || []} \n          accounts={accounts || []}\n          selectedAccountId={selectedAccountId}\n        />\n      </div>\n    </main>\n  )\n}\n\nexport default function TransactionsPage(props: { searchParams: Promise<{ account?: string }> }) {\n  return (\n    <Suspense fallback={\n    <div className=\"fixed inset-0 flex items-center justify-center bg-background z-[100] overflow-hidden\">\n      <div className=\"flex flex-col items-center gap-4 px-4 w-full max-w-xs sm:max-w-sm\">\n        <div className=\"relative\">\n          <img \n            src=\"/hisaab-logo-main.png\"\n            alt=\"Hisaab Logo\" \n            className=\"h-12 w-12 animate-pulse sm:h-16 sm:w-16\"\n          />\n        </div>\n        <div className=\"h-1.5 w-full max-w-[96px] overflow-hidden rounded-full bg-muted sm:max-w-[128px] sm:h-2\">\n          <div className=\"h-full w-full animate-progress rounded-full bg-indigo-600\"></div>\n        </div>\n      </div>\n    </div>}>\n      <TransactionsContent {...props} />\n    </Suspense>\n  )\n}"],"names":[],"mappings":"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","ignoreList":[1]}